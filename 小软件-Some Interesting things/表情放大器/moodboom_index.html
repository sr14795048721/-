<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡¨æƒ…æ”¾å¤§å™¨Â·MoodBoom!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 1s ease;
            overflow: hidden;
        }

        .container {
            text-align: center;
            z-index: 10;
            position: relative;
        }

        h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .api-section {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            backdrop-filter: blur(10px);
        }

        .api-input {
            padding: 0.5rem;
            margin: 0.25rem;
            border: none;
            border-radius: 10px;
            width: 200px;
            font-size: 0.9rem;
        }

        .api-status {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-success { color: #4CAF50; }
        .status-error { color: #f44336; }
        .status-testing { color: #ff9800; }

        #textInput {
            padding: 1rem;
            font-size: 1.1rem;
            border: none;
            border-radius: 25px;
            outline: none;
            width: 300px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        #submitBtn {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        #submitBtn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        #moodDisplay {
            color: white;
            font-size: 1.2rem;
            margin-top: 1rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        #emojiContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        .emoji {
            position: absolute;
            font-size: 3rem;
            animation: emojiFloat 3s ease-out forwards;
        }

        @keyframes emojiFloat {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 1;
            }
            50% {
                transform: translateY(50vh) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-20vh) scale(0.5);
                opacity: 0;
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            #textInput {
                width: 280px;
                font-size: 1rem;
            }
            
            .emoji {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }
            
            #textInput {
                width: 250px;
            }
            
            .container {
                padding: 1rem;
            }
        }

        /* æƒ…ç»ªèƒŒæ™¯è‰² */
        .happy { background: linear-gradient(135deg, #ffd89b, #19547b) !important; }
        .calm { background: linear-gradient(135deg, #667eea, #764ba2) !important; }
        .sad { background: linear-gradient(135deg, #bdc3c7, #2c3e50) !important; }
        .angry { background: linear-gradient(135deg, #ff416c, #ff4b2b) !important; }
        .surprised { background: linear-gradient(135deg, #a8edea, #fed6e3) !important; }
    </style>
</head>
<body>
    <div class="container">
        <h1>è¡¨æƒ…æ”¾å¤§å™¨Â·MoodBoom!</h1>
        
        <div class="api-section">
            <div style="color: white; margin-bottom: 0.5rem;">APIé…ç½®</div>
            <input type="password" id="apiKey" class="api-input" placeholder="API Key" value="">
            <input type="text" id="baseUrl" class="api-input" placeholder="Base URL" value="https://api.deepseek.com/v1">
            <input type="text" id="model" class="api-input" placeholder="Model" value="deepseek-chat">
            <button id="testApiBtn" style="padding: 0.5rem 1rem; margin: 0.25rem; border: none; border-radius: 10px; cursor: pointer; background: #4CAF50; color: white;">æµ‹è¯•è¿æ¥</button>
            <div id="apiStatus" class="api-status">APIçŠ¶æ€ï¼šæœªæµ‹è¯•</div>
        </div>
        
        <div class="input-section">
            <input type="text" id="textInput" placeholder="è¾“å…¥ä½ çš„å¿ƒæƒ…æ–‡å­—...">
            <button id="submitBtn">æäº¤</button>
        </div>
        <div id="moodDisplay">æ£€æµ‹åˆ°çš„æƒ…ç»ªï¼šæœªæ£€æµ‹</div>
    </div>
    <div id="emojiContainer"></div>

    <script>
        // æƒ…ç»ªè¯å…¸
        const moodDict = {
            happy: {
                keywords: ['å¼€å¿ƒ', 'å¿«ä¹', 'é«˜å…´', 'å…´å¥‹', 'æ„‰å¿«', 'æ¬¢ä¹', 'å–œæ‚¦', 'å¹¸ç¦', 'æ»¡è¶³', 'æ£’', 'å¥½', 'çˆ±'],
                emojis: ['ğŸ˜Š', 'ğŸ˜„', 'ğŸ¥³', 'ğŸ˜', 'ğŸ¤—', 'ğŸ’–', 'ğŸŒŸ', 'ğŸ‰', 'ğŸ‘', 'ğŸ’•'],
                name: 'å¼€å¿ƒ'
            },
            calm: {
                keywords: ['å¹³é™', 'å®‰å®', 'æ”¾æ¾', 'èˆ’é€‚', 'å®é™', 'æ·¡å®š', 'å†·é™', 'å®‰é™', 'ç¥¥å’Œ', 'æ¸©å’Œ'],
                emojis: ['ğŸ˜Œ', 'ğŸ§˜', 'ğŸŒŠ', 'ğŸ•Šï¸', 'ğŸŒ¸', 'ğŸƒ', 'â˜ï¸', 'ğŸŒ™', 'ğŸ’™', 'ğŸ¤'],
                name: 'å¹³é™'
            },
            sad: {
                keywords: ['ä¼¤å¿ƒ', 'éš¾è¿‡', 'æ‚²ä¼¤', 'æ²®ä¸§', 'å¤±è½', 'ç—›è‹¦', 'å“­', 'å¿§éƒ', 'å­¤ç‹¬', 'ç»æœ›'],
                emojis: ['ğŸ˜¢', 'ğŸ˜­', 'ğŸ’”', 'ğŸ˜', 'ğŸ˜”', 'ğŸŒ§ï¸', 'â›ˆï¸', 'ğŸ¥€', 'ğŸ’§', 'ğŸ˜¿'],
                name: 'ä¼¤å¿ƒ'
            },
            angry: {
                keywords: ['æ„¤æ€’', 'ç”Ÿæ°”', 'æ¼ç«', 'æš´èº', 'æ„¤æ…¨', 'æ€’', 'ç«å¤§', 'çƒ¦èº', 'è®¨åŒ', 'æ¨'],
                emojis: ['ğŸ˜ ', 'ğŸ˜¡', 'ğŸ¤¬', 'ğŸ’¢', 'ğŸ”¥', 'âš¡', 'ğŸ‘¿', 'ğŸ˜¤', 'ğŸ’¥', 'ğŸŒ‹'],
                name: 'æ„¤æ€’'
            },
            surprised: {
                keywords: ['æƒŠè®¶', 'éœ‡æƒŠ', 'æ„å¤–', 'åƒæƒŠ', 'æƒŠå¥‡', 'ä¸æ•¢ç›¸ä¿¡', 'å“‡', 'å¤©å“ª', 'æƒŠå‘†'],
                emojis: ['ğŸ˜²', 'ğŸ˜±', 'ğŸ¤¯', 'ğŸ˜®', 'ğŸ™€', 'âœ¨', 'ğŸ’«', 'ğŸ†', 'ğŸŒ ', 'â­'],
                name: 'æƒŠè®¶'
            }
        };

        const textInput = document.getElementById('textInput');
        const submitBtn = document.getElementById('submitBtn');
        const moodDisplay = document.getElementById('moodDisplay');
        const emojiContainer = document.getElementById('emojiContainer');
        const body = document.body;
        const apiKeyInput = document.getElementById('apiKey');
        const baseUrlInput = document.getElementById('baseUrl');
        const modelInput = document.getElementById('model');
        const testApiBtn = document.getElementById('testApiBtn');
        const apiStatus = document.getElementById('apiStatus');

        async function testApiConnection() {
            const apiKey = apiKeyInput.value.trim();
            const baseUrl = baseUrlInput.value.trim();
            const model = modelInput.value.trim();
            
            if (!apiKey || !baseUrl || !model) {
                apiStatus.textContent = 'APIçŠ¶æ€ï¼šè¯·å¡«å†™å®Œæ•´é…ç½®';
                apiStatus.className = 'api-status status-error';
                return false;
            }
            
            apiStatus.textContent = 'APIçŠ¶æ€ï¼šæµ‹è¯•ä¸­...';
            apiStatus.className = 'api-status status-testing';
            
            try {
                const response = await fetch(`${baseUrl}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [{ role: 'user', content: 'æµ‹è¯•' }],
                        max_tokens: 10
                    })
                });
                
                if (response.ok) {
                    apiStatus.textContent = 'APIçŠ¶æ€ï¼šè¿æ¥æˆåŠŸ';
                    apiStatus.className = 'api-status status-success';
                    return true;
                } else {
                    apiStatus.textContent = `APIçŠ¶æ€ï¼šè¿æ¥å¤±è´¥ (${response.status})`;
                    apiStatus.className = 'api-status status-error';
                    return false;
                }
            } catch (error) {
                apiStatus.textContent = `APIçŠ¶æ€ï¼šè¿æ¥é”™è¯¯ - ${error.message}`;
                apiStatus.className = 'api-status status-error';
                return false;
            }
        }

        async function detectMoodWithLLM(text) {
            const apiKey = apiKeyInput.value.trim();
            const baseUrl = baseUrlInput.value.trim();
            const model = modelInput.value.trim();
            
            if (!apiKey || !baseUrl || !model) {
                throw new Error('è¯·å…ˆé…ç½®å¹¶æµ‹è¯•APIè¿æ¥');
            }
            
            const prompt = `è¯·åˆ†æä»¥ä¸‹æ–‡æœ¬çš„æƒ…æ„Ÿï¼Œåªè¿”å›ä»¥ä¸‹äº”ä¸ªé€‰é¡¹ä¹‹ä¸€ï¼šhappyã€calmã€sadã€angryã€surprised\n\næ–‡æœ¬ï¼š"${text}"`;
            
            try {
                const response = await fetch(`${baseUrl}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 50,
                        temperature: 0.3
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                const result = data.choices[0].message.content.trim().toLowerCase();
                
                // éªŒè¯è¿”å›çš„æƒ…ç»ªæ˜¯å¦æœ‰æ•ˆ
                const validMoods = ['happy', 'calm', 'sad', 'angry', 'surprised'];
                for (const mood of validMoods) {
                    if (result.includes(mood)) {
                        return mood;
                    }
                }
                
                return 'calm'; // é»˜è®¤æƒ…ç»ª
            } catch (error) {
                console.error('æƒ…æ„Ÿåˆ†æå¤±è´¥:', error);
                throw error;
            }
        }

        function createEmojiExplosion(mood) {
            const emojis = moodDict[mood].emojis;
            const emojiCount = 30;
            
            // æ¸…é™¤ä¹‹å‰çš„emoji
            emojiContainer.innerHTML = '';
            
            for (let i = 0; i < emojiCount; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.className = 'emoji';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    
                    // éšæœºä½ç½®ï¼ˆä»å·¦å³ä¸¤è¾¹å–·å‘ï¼‰
                    const side = Math.random() > 0.5 ? 'left' : 'right';
                    emoji.style[side] = Math.random() * 20 + '%';
                    emoji.style.bottom = '0px';
                    
                    // éšæœºå»¶è¿Ÿå’ŒåŠ¨ç”»æ—¶é—´
                    emoji.style.animationDelay = Math.random() * 0.5 + 's';
                    emoji.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    
                    emojiContainer.appendChild(emoji);
                    
                    // 3ç§’åç§»é™¤emoji
                    setTimeout(() => {
                        if (emoji.parentNode) {
                            emoji.parentNode.removeChild(emoji);
                        }
                    }, 3000);
                }, i * 50);
            }
        }

        async function handleSubmit() {
            const text = textInput.value.trim();
            
            if (!text) {
                alert('è¯·è¾“å…¥ä¸€äº›å†…å®¹');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            moodDisplay.textContent = 'æ­£åœ¨åˆ†ææƒ…ç»ª...';
            submitBtn.disabled = true;
            submitBtn.textContent = 'åˆ†æä¸­...';
            
            try {
                const mood = await detectMoodWithLLM(text);
                const moodName = moodDict[mood].name;
                
                // æ›´æ–°æƒ…ç»ªæ˜¾ç¤º
                moodDisplay.textContent = `æ£€æµ‹åˆ°çš„æƒ…ç»ªï¼š${moodName}`;
                
                // æ›´æ”¹èƒŒæ™¯è‰²
                body.className = mood;
                
                // åˆ›å»ºemojiçˆ†ç‚¸æ•ˆæœ
                createEmojiExplosion(mood);
            } catch (error) {
                moodDisplay.textContent = `æƒ…ç»ªåˆ†æå¤±è´¥ï¼š${error.message}`;
                alert(`é”™è¯¯ï¼š${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'æäº¤';
            }
        }

        // äº‹ä»¶ç›‘å¬
        submitBtn.addEventListener('click', handleSubmit);
        textInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleSubmit();
            }
        });
        testApiBtn.addEventListener('click', testApiConnection);
    </script>
</body>
</html>